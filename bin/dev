#!/usr/bin/env bash
set -euo pipefail
#!/usr/bin/env bash
set -euo pipefail

# foreman の絶対パスを取得し、未導入なら導入
FM="$(ruby -e 'puts Gem.bindir')/foreman"
if [ ! -x "$FM" ]; then
  gem install foreman -N
  FM="$(ruby -e 'puts Gem.bindir')/foreman"
fi

# foreman/rails が確実に見えるように Gem bin を PATH に追加
export PATH="$(ruby -e 'puts Gem.bindir'):$PATH"

# CSS を一度だけビルド（watch はしない）
bin/rails tailwindcss:build || true

# Rails の pid が残っていたら削除
rm -f tmp/pids/server.pid

# Procfile.dev（webのみ）で起動
exec "$FM" start -f Procfile.dev
